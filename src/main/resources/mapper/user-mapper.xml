<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cxh.mybatis.mybatisdemo.dao.UserMapper">
    <!--    namespace是映射所在的类
            id是定义的方法名
            resultType是返回值类型，应该写全类名，但在配置中已经配置了包名
            #{id}是传进来的参数
            parameterType是传进来的参数类型，User不是java自带的所以要声明
            keyProperty是自增主键
            <sql>标签是集成的sql语句
    -->

    <sql id="selectField">
        id,username,password,score
    </sql>

    <sql id="insertField">
        (`username`, `password`,`score`)
    </sql>

    <select id="selectById" resultType="com.cxh.mybatis.mybatisdemo.entity.User">
        select <include refid="selectField"></include>
        from user
        where id=#{id}
    </select>

    <select id="selectUsers" resultMap="userMap">
        select <include refid="selectField"></include>
        from user
        where status=0
    </select>

    <select id="selectByUsername" resultType="com.cxh.mybatis.mybatisdemo.entity.User">
        select <include refid="selectField"></include>
        from user
        where username=#{username}
    </select>

    <select id="selectUsersList" resultMap="userMap">
        select <include refid="selectField"></include>
        from user
        where score=#{score,javaType=com.cxh.mybatis.mybatisdemo.enums.UserScore,jdbcType=INTEGER,typeHandler=com.cxh.mybatis.mybatisdemo.enums.UserScoreTypeHandler}
        and status=0
        and username like #{username}
    </select>

    <insert id="insertUser" parameterType="com.cxh.mybatis.mybatisdemo.entity.User" keyProperty="id">
        insert into user <include refid="insertField"></include>
        values(#{username},
               #{password},
               #{score,javaType=com.cxh.mybatis.mybatisdemo.enums.UserScore,jdbcType=INTEGER,typeHandler=com.cxh.mybatis.mybatisdemo.enums.UserScoreTypeHandler})
    </insert>

    <update id="updatePassword">
        update user set password=#{password}
        where id=#{id}
    </update>

    <update id="updateStatus">
        update user set status=#{status}
        where id=#{id}
    </update>

    <resultMap id="userMap" type="com.cxh.mybatis.mybatisdemo.entity.User">
        <result property="id" column="id"></result>
        <result property="username" column="username"></result>
        <result property="password" column="password"></result>
        <result property="status" column="status"></result>
        <result property="score" column="score" typeHandler="com.cxh.mybatis.mybatisdemo.enums.UserScoreTypeHandler"></result>
    </resultMap>

    <insert id="addUsers" parameterType="com.cxh.mybatis.mybatisdemo.entity.User">
        insert into user <include refid="insertField"></include>
            <!--<foreach collection="users" item="user" open="(" separator="," close=")">-->
            values (#{username},
                    #{password},
                    #{score,javaType=com.cxh.mybatis.mybatisdemo.enums.UserScore,jdbcType=INTEGER,typeHandler=com.cxh.mybatis.mybatisdemo.enums.UserScoreTypeHandler})
        <!--</foreach>-->

</insert>

</mapper>